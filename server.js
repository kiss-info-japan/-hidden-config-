require('dotenv').config();
const express = require('express');
const cors = require('cors');
const fetch = require('node-fetch');

const app = express();
const PORT = 3000;

app.use(cors());
app.use(express.json());

const MISTRAL_API_KEY = process.env.MISTRAL_API_KEY;
if (!MISTRAL_API_KEY) {
    console.error("ğŸš¨ MISTRAL_API_KEY ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ï¼.env ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
    process.exit(1);
}

const MISTRAL_API_URL = "https://api.mistral.ai/v1/chat/completions";

// ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®è¨ºæ–­ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
const userSessions = {};

// ğŸ“Œ è¨ºæ–­ãƒ†ã‚¹ãƒˆé–‹å§‹API
app.post('/start-diagnosis', async (req, res) => {
    const { userId } = req.body;
    if (!userId) {
        return res.status(400).json({ error: "userId ãŒå¿…è¦ã§ã™ã€‚" });
    }

    try {
        const questionPrompt = `
        å®—æ•™è¦³ã‚’è¨ºæ–­ã™ã‚‹ãŸã‚ã®è³ªå•ã‚’15å€‹è€ƒãˆã¦ãã ã•ã„ã€‚  
        - è‡ªç”±å›ç­”å½¢å¼ã®è³ªå•ã«ã™ã‚‹ã“ã¨ã€‚  
        - é›£ã—ã„å°‚é–€ç”¨èªã‚’ä½¿ã‚ãšã€æ—¥å¸¸çš„ãªè¨€è‘‰ã‚’ä½¿ã†ã€‚  
        - ç›´æ„Ÿçš„ã«ç­”ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚  
        - ã€Œä¿¡ä»°ã€ã‚„ã€Œå®—æ•™ã€ã¨ã„ã†è¨€è‘‰ã‚’ä½¿ã‚ãªãã¦ã‚‚ã€è‡ªåˆ†ã®ä¾¡å€¤è¦³ã‚’è€ƒãˆãªãŒã‚‰ç­”ãˆã‚‰ã‚Œã‚‹è³ªå•ã«ã™ã‚‹ã€‚  
        - å…·ä½“çš„ãªå ´é¢ã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸ã—ã‚„ã™ã„ã‚ˆã†ã«ã™ã‚‹ã€‚  
        - Yes/No ã§ã¯ãªãã€è‡ªç”±ã«è€ƒãˆã‚’è¿°ã¹ã‚‰ã‚Œã‚‹å½¢å¼ã«ã™ã‚‹ã€‚  
        `;

        const response = await fetch(MISTRAL_API_URL, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${MISTRAL_API_KEY}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                model: 'mistral-medium',
                messages: [{ role: 'user', content: questionPrompt }]
            })
        });

        const data = await response.json();
        if (!response.ok) {
            console.error("ğŸš¨ Mistral API ã‚¨ãƒ©ãƒ¼:", data);
            throw new Error(data.error?.message || 'Mistral API error');
        }

        // è³ªå•ãƒªã‚¹ãƒˆã‚’å–å¾—
        const questions = data.choices[0].message.content
            .split('\n')
            .map(q => q.replace(/^\d+\.\s*/, '').trim())
            .filter(q => q.length > 0);

        if (questions.length < 15) {
            return res.status(500).json({ error: "è³ªå•ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚" });
        }

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
        userSessions[userId] = { questions, answers: [] };

        // æœ€åˆã®è³ªå•ã‚’é€ä¿¡
        res.json({ reply: `æœ€åˆã®è³ªå•ã§ã™\n${questions[0]}` });

    } catch (error) {
        console.error("ğŸš¨ ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼:", error);
        res.status(500).json({ error: error.message });
    }
});

// ğŸ“Œ è¨ºæ–­ãƒ†ã‚¹ãƒˆã®é€²è¡ŒAPI
app.post('/chat', async (req, res) => {
    try {
        const { userId, message } = req.body;
        if (!userId || !message) {
            return res.status(400).json({ error: "userIdã¨messageãŒå¿…è¦ã§ã™ã€‚" });
        }

        // è¨ºæ–­ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒãªã„å ´åˆ
        if (!userSessions[userId]) {
            return res.status(400).json({ error: "è¨ºæ–­ãŒã¾ã é–‹å§‹ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚" });
        }

        const session = userSessions[userId];
        session.answers.push(message);

        // æ¬¡ã®è³ªå•ã‚’é€ã‚‹
        const nextQuestionIndex = session.answers.length;
        if (nextQuestionIndex < session.questions.length) {
            return res.json({
                reply: `${nextQuestionIndex + 1}ç•ªç›®ã®è³ªå•:\n${session.questions[nextQuestionIndex]}`
            });
        }

       // ğŸ“Œ è¨ºæ–­ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆMistral AI ã«ä¾é ¼ï¼‰
       const diagnosisPrompt = 
       `ä»¥ä¸‹ã®è³ªå•ã¨å›ç­”ã«åŸºã¥ãã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¡Œå‹•åŸç†ã‚’æ”¯ãˆã‚‹ã€ŒHidden Configã€ã‚’è§£æã—ã€æœ€é©ãªã€ŒInstalled Religionã€ã‚’è¡¨ç¤ºã—ã¦ãã ã•ã„ã€‚
       
       ã€è¨ºæ–­ãƒ«ãƒ¼ãƒ«ã€‘
       - ä»¥ä¸‹ã®ãƒªã‚¹ãƒˆã‹ã‚‰æœ€ã‚‚é©ã—ãŸã‚‚ã®ã‚’1ã¤é¸æŠã—ã¦ãã ã•ã„ã€‚
       - å¿…ãšä»¥ä¸‹ã®ãƒªã‚¹ãƒˆå†…ã®å®—æ•™ã®ã¿ã‚’1ã¤é¸æŠã—ã¦ãã ã•ã„ã€‚
       - ãƒªã‚¹ãƒˆå¤–ã®è¨€è‘‰ï¼ˆä¾‹ï¼šã€Œç„¡æ•™ã€ãªã©ï¼‰ã‚’ç”Ÿæˆã—ãªã„ã“ã¨ã€‚
â€¢	ã‚­ãƒªã‚¹ãƒˆæ•™ 
o	æ¦‚è¦: ç´€å…ƒ1ä¸–ç´€ã«ã‚¤ã‚¨ã‚¹ãƒ»ã‚­ãƒªã‚¹ãƒˆã®æ•™ãˆã«åŸºã¥ã„ã¦æˆç«‹ã€‚ç¥ã®æ„›ã¨æ•‘æ¸ˆã‚’ä¸­å¿ƒã¨ã—ã€è–æ›¸ã‚’è–å…¸ã¨ã™ã‚‹ã€‚ã‚«ãƒˆãƒªãƒƒã‚¯ã€ãƒ—ãƒ­ãƒ†ã‚¹ã‚¿ãƒ³ãƒˆã€æ­£æ•™ä¼šãªã©ã®å®—æ´¾ãŒã‚ã‚‹ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: ã‚¤ã‚¨ã‚¹ãƒ»ã‚­ãƒªã‚¹ãƒˆã‚’ç¥ã®å­ã¨ã—ã¦ä¿¡ã˜ã€å½¼ã®æ­»ã¨å¾©æ´»ã«ã‚ˆã£ã¦ç½ªã‹ã‚‰ã®æ•‘æ¸ˆãŒå¾—ã‚‰ã‚Œã‚‹ã¨ã™ã‚‹ã€‚
â€¢	ã‚¤ã‚¹ãƒ©ãƒ æ•™ 
o	æ¦‚è¦: 7ä¸–ç´€ã«ãƒ ãƒãƒ³ãƒãƒ‰ã«ã‚ˆã£ã¦é–‹ã‹ã‚ŒãŸå®—æ•™ã€‚å”¯ä¸€ç¥ã‚¢ãƒƒãƒ©ãƒ¼ã¸ã®ä¿¡ä»°ã€ã‚³ãƒ¼ãƒ©ãƒ³ã®æ•™ãˆã€äº”è¡Œï¼ˆä¿¡ä»°å‘Šç™½ã€ç¤¼æ‹ã€æ–­é£Ÿã€å–œæ¨ã€å·¡ç¤¼ï¼‰ã‚’é‡è¦–ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: ã‚¢ãƒƒãƒ©ãƒ¼ã®ã¿ã‚’å”¯ä¸€ç¥ã¨ã—ã€ãƒ ãƒãƒ³ãƒãƒ‰ã¯æœ€å¾Œã®é è¨€è€…ã¨ã•ã‚Œã‚‹ã€‚ã‚·ãƒ£ãƒªãƒ¼ã‚¢ï¼ˆã‚¤ã‚¹ãƒ©ãƒ æ³•ï¼‰ã«å¾“ã†ã€‚
â€¢	ä»æ•™ 
o	æ¦‚è¦: ç´€å…ƒå‰5ä¸–ç´€é ƒã«ã‚¤ãƒ³ãƒ‰ã§é‡ˆè¿¦ã«ã‚ˆã£ã¦é–‹ã‹ã‚ŒãŸã€‚è‹¦ã—ã¿ã®åŸå› ã‚’è§£æ˜ã—ã€è§£è„±ã‚’ç›®æŒ‡ã™ã€‚ä¸Šåº§éƒ¨ä»æ•™ã€å¤§ä¹—ä»æ•™ã€ãƒãƒ™ãƒƒãƒˆä»æ•™ãªã©ãŒã‚ã‚‹ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: å››è«¦ï¼ˆè‹¦ãƒ»é›†ãƒ»æ»…ãƒ»é“ï¼‰ã¨å…«æ­£é“ã‚’é‡è¦–ã—ã€ç…©æ‚©ã‚’æ–­ã¡åˆ‡ã‚‹ã“ã¨ã§è¼ªå»»ã‹ã‚‰è§£è„±ã§ãã‚‹ã¨è€ƒãˆã‚‹ã€‚
â€¢	ãƒ’ãƒ³ãƒ‰ã‚¥ãƒ¼æ•™ 
o	æ¦‚è¦: ã‚¤ãƒ³ãƒ‰ã®ä¼çµ±çš„ãªå®—æ•™ã§ã€å¤šç¥æ•™çš„è¦ç´ ã‚’æŒã¤ã€‚è¼ªå»»è»¢ç”Ÿã¨ã‚«ãƒ«ãƒã®æ€æƒ³ã‚’åŸºç›¤ã«ã—ã€ãƒ´ã‚§ãƒ¼ãƒ€è–å…¸ã‚’é‡è¦–ã™ã‚‹ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: ãƒ–ãƒ©ãƒ•ãƒãƒ¼ï¼ˆå‰µé€ ï¼‰ã€ãƒ´ã‚£ã‚·ãƒ¥ãƒŒï¼ˆç¶­æŒï¼‰ã€ã‚·ãƒ´ã‚¡ï¼ˆç ´å£Šï¼‰ãªã©ã®ç¥ã€…ã‚’ä¿¡ä»°ã—ã€ã‚«ãƒ«ãƒã«ã‚ˆã£ã¦æ¥ä¸–ãŒæ±ºã¾ã‚‹ã¨è€ƒãˆã‚‹ã€‚
â€¢	ãƒ¦ãƒ€ãƒ¤æ•™ 
o	æ¦‚è¦: ç´€å…ƒå‰10ä¸–ç´€é ƒã«ãƒ˜ãƒ–ãƒ©ã‚¤äººã«ã‚ˆã£ã¦å½¢æˆã€‚å”¯ä¸€ç¥ãƒ¤ãƒã‚¦ã‚§ã‚’ä¿¡ä»°ã—ã€å¾‹æ³•ï¼ˆãƒˆãƒ¼ãƒ©ãƒ¼ï¼‰ã‚’å³å®ˆã€‚ã‚­ãƒªã‚¹ãƒˆæ•™ãƒ»ã‚¤ã‚¹ãƒ©ãƒ æ•™ã®æºæµã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: ç¥ã¨ã‚¤ã‚¹ãƒ©ã‚¨ãƒ«ã®æ°‘ã¨ã®å¥‘ç´„ã‚’é‡è¦–ã—ã€613ã®æˆ’å¾‹ã‚’å®ˆã‚‹ã“ã¨ãŒæ±‚ã‚ã‚‰ã‚Œã‚‹ã€‚ãƒ¡ã‚·ã‚¢ï¼ˆæ•‘æ¸ˆè€…ï¼‰ã®åˆ°æ¥ã‚’å¾…ã¤ã€‚
â€¢	ã‚·ã‚¯æ•™ 
o	æ¦‚è¦: 15ä¸–ç´€ã«ã‚¤ãƒ³ãƒ‰ã®ã‚°ãƒ«ãƒ»ãƒŠãƒ¼ãƒŠã‚¯ã«ã‚ˆã£ã¦å‰µå§‹ã€‚ãƒ’ãƒ³ãƒ‰ã‚¥ãƒ¼æ•™ã¨ã‚¤ã‚¹ãƒ©ãƒ æ•™ã®è¦ç´ ã‚’èåˆã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: å”¯ä¸€ç¥ãƒ¯ãƒ¼ãƒ˜ã‚°ãƒ«ã‚’ä¿¡ä»°ã—ã€å¹³ç­‰ã¨åŠ´åƒã€å¥‰ä»•ã‚’é‡è¦–ã™ã‚‹ã€‚
â€¢	é“æ•™ 
o	æ¦‚è¦: ç´€å…ƒå‰4ä¸–ç´€é ƒã«ä¸­å›½ã§æˆç«‹ã€‚è€å­ãƒ»è˜å­ã®æ€æƒ³ã‚’ã‚‚ã¨ã«ã€è‡ªç„¶ã¨ã®èª¿å’Œã‚„ä¸è€ä¸æ­»ã‚’ç›®æŒ‡ã™ã€‚æ°—ã®æµã‚Œï¼ˆé“ï¼‰ã‚’é‡è¦–ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: é“ï¼ˆã‚¿ã‚ªï¼‰ã«å¾“ã„ã€ç„¡ç‚ºè‡ªç„¶ã®ç”Ÿãæ–¹ã‚’å®Ÿè·µã™ã‚‹ã“ã¨ã§èª¿å’Œã‚’å¾—ã‚‹ã€‚
â€¢	ç¥é“ 
o	æ¦‚è¦: æ—¥æœ¬å›ºæœ‰ã®å®—æ•™ã§ã€è‡ªç„¶å´‡æ‹ã¨ç¥–å…ˆä¿¡ä»°ã‚’ä¸­å¿ƒã¨ã™ã‚‹ã€‚å…«ç™¾ä¸‡ã®ç¥ã‚’ä¿¡ã˜ã€ç¥ç¤¾ã§ã®ç¥­ç¥€ãŒç‰¹å¾´ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: ç¥ã€…ã¨ã®èª¿å’Œã‚’å¤§åˆ‡ã«ã—ã€ç©¢ã‚Œã‚’ç¥“ã†ã“ã¨ã§æ¸…æµ„ãªçŠ¶æ…‹ã‚’ä¿ã¤ã€‚
â€¢	ã‚¾ãƒ­ã‚¢ã‚¹ã‚¿ãƒ¼æ•™ 
o	æ¦‚è¦: ç´€å…ƒå‰6ä¸–ç´€é ƒã«ãƒšãƒ«ã‚·ãƒ£ã§ã‚¾ãƒ­ã‚¢ã‚¹ã‚¿ãƒ¼ï¼ˆã‚¶ãƒ©ã‚¹ã‚·ãƒ¥ãƒˆãƒ©ï¼‰ãŒå‰µå§‹ã€‚å…‰ã¨é—‡ã®äºŒå…ƒè«–ã‚’ç‰¹å¾´ã¨ã™ã‚‹ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: å”¯ä¸€ç¥ã‚¢ãƒ•ãƒ©ãƒ»ãƒã‚ºãƒ€ãƒ¼ã‚’å´‡æ‹ã—ã€å–„æ‚ªã®æˆ¦ã„ã®ä¸­ã§å–„ã‚’é¸ã¶ã“ã¨ãŒæ±‚ã‚ã‚‰ã‚Œã‚‹ã€‚ç«ã‚’ç¥è–è¦–ã™ã‚‹ã€‚
â€¢	ã‚·ãƒ£ãƒ¼ãƒãƒ‹ã‚ºãƒ  
o	æ¦‚è¦: ä¸–ç•Œå„åœ°ã®å…ˆä½æ°‘ã®å®—æ•™å½¢æ…‹ã€‚ç²¾éœŠä¿¡ä»°ã‚„ç¥–éœŠå´‡æ‹ã‚’ä¸­å¿ƒã¨ã—ã€ã‚·ãƒ£ãƒ¼ãƒãƒ³ï¼ˆå‘ªè¡“å¸«ï¼‰ãŒéœŠçš„ãªåŠ›ã‚’åª’ä»‹ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: ç²¾éœŠã¨ã®äº¤æµã‚’é€šã˜ã¦ç—…æ°—ã®æ²»ç™’ã‚„æœªæ¥ã®äºˆè¦‹ã‚’è¡Œã†ã€‚
â€¢	ã‚µã‚¿ãƒ‹ã‚ºãƒ  
o	æ¦‚è¦: 19ä¸–ç´€ä»¥é™ã«ç™ºå±•ã—ãŸã€ã‚­ãƒªã‚¹ãƒˆæ•™ã®ã€Œæ‚ªé­”å´‡æ‹ã€ã®æ¦‚å¿µã«ç”±æ¥ã™ã‚‹æ€æƒ³ã‚„å®Ÿè·µã®ç·ç§°ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: ä¼çµ±çš„ãªæ‚ªé­”å´‡æ‹ã ã‘ã§ãªãã€äººé–“ã®è‡ªç”±æ„å¿—ã‚’é‡è¦–ã™ã‚‹å“²å­¦çš„ã‚µã‚¿ãƒ‹ã‚ºãƒ ã‚‚å­˜åœ¨ã™ã‚‹ã€‚
â€¢	ã‚¯ãƒªã‚¹ãƒãƒ£ãƒ³ãƒ»ã‚µã‚¤ã‚¨ãƒ³ã‚¹ 
o	æ¦‚è¦: 19ä¸–ç´€ã«ã‚¢ãƒ¡ãƒªã‚«ã§ãƒ¡ã‚¢ãƒªãƒ¼ãƒ»ãƒ™ãƒ¼ã‚«ãƒ¼ãƒ»ã‚¨ãƒ‡ã‚£ã«ã‚ˆã£ã¦å‰µå§‹ã€‚ç—…æ°—ã‚’ç²¾ç¥çš„ã«æ²»ç™’ã§ãã‚‹ã¨è€ƒãˆã‚‹ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: ç‰©è³ªä¸–ç•Œã®ç¾å®Ÿæ€§ã‚’å¦å®šã—ã€ç¥ã®åŠ›ã«ã‚ˆã‚‹ç™’ã—ã‚’é‡è¦–ã™ã‚‹ã€‚
â€¢	ãƒ ã‚¹ãƒªãƒ ãƒ»ã‚·ãƒ¼ã‚¢æ´¾ 
o	æ¦‚è¦: ã‚¤ã‚¹ãƒ©ãƒ æ•™ã®ä¸€æ´¾ã§ã€ã‚¢ãƒªãƒ¼ã‚’ãƒ ãƒãƒ³ãƒãƒ‰ã®æ­£çµ±ãªå¾Œç¶™è€…ã¨ã™ã‚‹ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: ã‚¤ãƒãƒ¼ãƒ ï¼ˆæŒ‡å°è€…ï¼‰ã‚’é‡è¦–ã—ã€ãƒ ãƒãƒ³ãƒãƒ‰ã®è¡€çµ±ã‚’ç¶™ãè€…ãŒå®—æ•™çš„æ¨©å¨ã‚’æŒã¤ã¨ã™ã‚‹ã€‚
â€¢	ãƒ ã‚¹ãƒªãƒ ãƒ»ã‚¹ãƒ³ãƒ‹æ´¾ 
o	æ¦‚è¦: ã‚¤ã‚¹ãƒ©ãƒ æ•™æœ€å¤§ã®å®—æ´¾ã§ã€ãƒ ãƒãƒ³ãƒãƒ‰ã®å¾Œç¶™è€…ã¯å…±åŒä½“ã®é¸æŠã«ã‚ˆã‚‹ã¨ã™ã‚‹ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: ã‚³ãƒ¼ãƒ©ãƒ³ã¨ãƒãƒ‡ã‚£ãƒ¼ã‚¹ï¼ˆé è¨€è€…ã®è¨€è¡ŒéŒ²ï¼‰ã‚’é‡è¦–ã—ã€ã‚¦ãƒ©ãƒãƒ¼ï¼ˆå®—æ•™å­¦è€…ï¼‰ã®æŒ‡å°ã‚’å°Šé‡ã™ã‚‹ã€‚
â€¢	ãƒ¢ãƒ«ãƒ¢ãƒ³æ•™ï¼ˆæœ«æ—¥è–å¾’ã‚¤ã‚¨ã‚¹ãƒ»ã‚­ãƒªã‚¹ãƒˆæ•™ä¼šï¼‰ 
o	æ¦‚è¦: 19ä¸–ç´€ã«ã‚¢ãƒ¡ãƒªã‚«ã§ã‚¸ãƒ§ã‚»ãƒ•ãƒ»ã‚¹ãƒŸã‚¹ãŒå‰µå§‹ã€‚ã‚­ãƒªã‚¹ãƒˆæ•™ã®ä¸€æ´¾ã¨ã•ã‚Œã‚‹ãŒç‹¬è‡ªã®æ•™ç¾©ã‚’æŒã¤ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: ã€ãƒ¢ãƒ«ãƒ¢ãƒ³æ›¸ã€ã‚’è–å…¸ã¨ã—ã€ç¥ã®å•“ç¤ºãŒç¾åœ¨ã‚‚ç¶šã„ã¦ã„ã‚‹ã¨ä¿¡ã˜ã‚‹ã€‚
â€¢	ã‚¢ãƒ•ãƒªã‚«ä¼çµ±å®—æ•™ 
o	æ¦‚è¦: ã‚¢ãƒ•ãƒªã‚«å„åœ°ã®å…ˆä½æ°‘ã®ä¿¡ä»°ã€‚ç²¾éœŠå´‡æ‹ã€ç¥–å…ˆå´‡æ‹ã€å‘ªè¡“ãªã©ã‚’å«ã‚€ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: ç¥–éœŠã¨ã®ã¤ãªãŒã‚Šã‚’é‡è¦–ã—ã€è‡ªç„¶ç•Œã®ç²¾éœŠã‚„ç¥ã€…ã‚’å´‡æ‹ã™ã‚‹ã€‚
â€¢	ã‚«ãƒãƒ© 
o	æ¦‚è¦: ãƒ¦ãƒ€ãƒ¤æ•™ç¥ç§˜ä¸»ç¾©ã®ä¸€å½¢æ…‹ã€‚å®‡å®™ã®ç¥ç§˜ã‚„ç¥ã¨ã®é–¢ä¿‚ã‚’è§£é‡ˆã™ã‚‹ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: ã€Œã‚»ãƒ•ã‚£ãƒ­ãƒˆã®æ¨¹ã€ã«è±¡å¾´ã•ã‚Œã‚‹å®‡å®™æ§‹é€ ã‚’ç ”ç©¶ã—ã€ç¥ã¨ã®åˆä¸€ã‚’ç›®æŒ‡ã™ã€‚
â€¢	ãƒ´ã‚£ã‚·ãƒ¥ãƒŒæ•™ 
o	æ¦‚è¦: ãƒ’ãƒ³ãƒ‰ã‚¥ãƒ¼æ•™ã®ä¸€æ´¾ã§ã€ãƒ´ã‚£ã‚·ãƒ¥ãƒŒç¥ã‚’æœ€é«˜ç¥ã¨ã™ã‚‹ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: ã‚¯ãƒªã‚·ãƒ¥ãƒŠã‚„ãƒ©ãƒ¼ãƒãªã©ã®åŒ–èº«ã‚’ä¿¡ä»°ã—ã€çŒ®èº«ï¼ˆãƒã‚¯ãƒ†ã‚£ï¼‰ã‚’é‡è¦–ã™ã‚‹ã€‚
â€¢	ã‚¸ãƒ£ã‚¤ãƒŠæ•™ 
o	æ¦‚è¦: ç´€å…ƒå‰6ä¸–ç´€é ƒã«ã‚¤ãƒ³ãƒ‰ã§æˆç«‹ã€‚æš´åŠ›ã‚’å¦å®šã—ã€å¾¹åº•ã—ãŸä¸æ®ºç”Ÿã‚’å®Ÿè·µã™ã‚‹ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: ã‚«ãƒ«ãƒã‚’å¦å®šã—ã€å³æ ¼ãªæˆ’å¾‹ã‚’å®ˆã‚‹ã“ã¨ã§è§£è„±ã‚’ç›®æŒ‡ã™ã€‚
â€¢	ãƒ­ãƒ¼ãƒã‚«ãƒˆãƒªãƒƒã‚¯ 
o	æ¦‚è¦: ã‚­ãƒªã‚¹ãƒˆæ•™ã®æœ€å¤§å®—æ´¾ã§ã€ãƒãƒã‚«ãƒ³å¸‚å›½ã«ç·æœ¬å±±ã‚’æŒã¤ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: æ•™çš‡ã®æ¨©å¨ã‚’èªã‚ã€è–æ¯ãƒãƒªã‚¢å´‡æ•¬ã‚’é‡è¦–ã™ã‚‹ã€‚
â€¢	ãƒ—ãƒ­ãƒ†ã‚¹ã‚¿ãƒ³ãƒˆ 
o	æ¦‚è¦: 16ä¸–ç´€ã®å®—æ•™æ”¹é©ã§ã‚«ãƒˆãƒªãƒƒã‚¯ã‹ã‚‰åˆ†é›¢ã—ãŸã‚­ãƒªã‚¹ãƒˆæ•™ã®ä¸€æ´¾ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: ã€Œè–æ›¸ã®ã¿ã€ã‚’åŸºæœ¬ã¨ã—ã€æ•™ä¼šã®æ¨©å¨ã‚ˆã‚Šã‚‚å€‹ã€…ã®ä¿¡ä»°ã‚’é‡è¦–ã™ã‚‹ã€‚
â€¢	ã‚¢ãƒ³ã‚°ãƒªã‚«ãƒ³æ•™ï¼ˆè‹±å›½å›½æ•™ä¼šï¼‰ 
o	æ¦‚è¦: 16ä¸–ç´€ã«ã‚¤ãƒ³ã‚°ãƒ©ãƒ³ãƒ‰ã§æˆç«‹ã—ã€ã‚«ãƒˆãƒªãƒƒã‚¯ã¨ãƒ—ãƒ­ãƒ†ã‚¹ã‚¿ãƒ³ãƒˆã®ä¸­é–“çš„ç«‹å ´ã‚’ã¨ã‚‹ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: å¸æ•™åˆ¶ã‚’æŒã¡ã¤ã¤ã‚‚ã€è–æ›¸ã¨å€‹äººã®è‰¯å¿ƒã‚’å°Šé‡ã™ã‚‹ã€‚
â€¢	ãƒ¡ã‚½ãƒã‚¿ãƒŸã‚¢å®—æ•™ 
o	æ¦‚è¦: å¤ä»£ãƒ¡ã‚½ãƒã‚¿ãƒŸã‚¢æ–‡æ˜ï¼ˆã‚·ãƒ¥ãƒ¡ãƒ¼ãƒ«ã€ã‚¢ãƒƒã‚«ãƒ‰ã€ãƒãƒ“ãƒ­ãƒ‹ã‚¢ï¼‰ã®ä¿¡ä»°ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: å¤šç¥æ•™ã§ã€ã‚¨ãƒ³ãƒªãƒ«ã€ã‚¤ã‚·ãƒ¥ã‚¿ãƒ«ã€ãƒãƒ«ãƒ‰ã‚¥ã‚¯ãªã©ã®ç¥ã€…ã‚’å´‡æ‹ã€‚
â€¢	ã‚¨ã‚¸ãƒ—ãƒˆç¥æ®¿ä¿¡ä»° 
o	æ¦‚è¦: å¤ä»£ã‚¨ã‚¸ãƒ—ãƒˆã®å®—æ•™ã€‚å¤ªé™½ç¥ãƒ©ãƒ¼ã‚„ã‚ªã‚·ãƒªã‚¹ç¥ã‚’ä¸­å¿ƒã¨ã™ã‚‹å¤šç¥æ•™ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: æ­»å¾Œã®ä¸–ç•Œã‚’é‡è¦–ã—ã€ãƒŸã‚¤ãƒ©ä½œã‚Šã‚„æ¥ä¸–ã§ã®å¾©æ´»ã‚’ä¿¡ã˜ã‚‹ã€‚
â€¢	ã‚¢ã‚¹ãƒ†ã‚«å®—æ•™ 
o	æ¦‚è¦: ã‚¢ã‚¹ãƒ†ã‚«æ–‡æ˜ã®å®—æ•™ã§ã€å¤šç¥æ•™ã®è¦ç´ ã‚’æŒã¤ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: å¤ªé™½ç¥ã‚¦ã‚£ãƒ„ã‚£ãƒ­ãƒãƒãƒˆãƒªã¸ã®ç”Ÿè´„ã‚’é‡è¦è¦–ã€‚
â€¢	ã‚¤ãƒ³ã‚«å®—æ•™ 
o	æ¦‚è¦: ã‚¤ãƒ³ã‚«å¸å›½ã®å®—æ•™ã§ã€å¤ªé™½ç¥ã‚¤ãƒ³ãƒ†ã‚£ã‚’æœ€é«˜ç¥ã¨ã™ã‚‹ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: ç‹ã‚’ç¥ã®å­ã¨ã—ã¦å´‡ã‚ã€ç¥–å…ˆå´‡æ‹ã‚’è¡Œã†ã€‚
ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ»ã‚¢ãƒ¡ãƒªã‚«ãƒ³å®—æ•™ 
o	æ¦‚è¦: åŒ—ç±³å…ˆä½æ°‘ã®ä¼çµ±çš„ä¿¡ä»°ã€‚ç²¾éœŠã‚„è‡ªç„¶å´‡æ‹ãŒä¸­å¿ƒã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: å¤§åœ°ã‚„å‹•ç‰©ã«å®¿ã‚‹ç²¾éœŠã‚’å°Šã³ã€éƒ¨æ—ã”ã¨ã«ç‹¬è‡ªã®ç¥è©±ã‚„å„€å¼ã‚’æŒã¤ã€‚
â€¢	ãƒ´ãƒ¼ãƒ‰ã‚¥ãƒ¼æ•™ 
o	æ¦‚è¦: è¥¿ã‚¢ãƒ•ãƒªã‚«èµ·æºã§ã€ãƒã‚¤ãƒã‚„ãƒ«ã‚¤ã‚¸ã‚¢ãƒŠãªã©ã«åºƒãŒã£ãŸæ°‘é–“ä¿¡ä»°ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: ãƒ­ã‚¢ã¨å‘¼ã°ã‚Œã‚‹ç²¾éœŠã‚’å´‡æ‹ã—ã€å„€å¼ã‚’é€šã˜ã¦äº¤æµã™ã‚‹ã€‚
â€¢	ã‚«ã‚ªãƒ€ã‚¤æ•™ 
o	æ¦‚è¦: 20ä¸–ç´€ã«ãƒ™ãƒˆãƒŠãƒ ã§æˆç«‹ã—ãŸæ–°å®—æ•™ã€‚è«¸å®—æ•™ã®è¦ç´ ã‚’èåˆã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: ä»æ•™ãƒ»é“æ•™ãƒ»ã‚­ãƒªã‚¹ãƒˆæ•™ãƒ»å„’æ•™ãªã©ã‚’çµ±åˆã—ã€ç¥ã®å•“ç¤ºã‚’é‡è¦–ã€‚
â€¢	ã‚·ã‚¯æ•™ 
o	æ¦‚è¦: 15ä¸–ç´€ã«ã‚¤ãƒ³ãƒ‰ã§æˆç«‹ã€‚ãƒ’ãƒ³ãƒ‰ã‚¥ãƒ¼æ•™ã¨ã‚¤ã‚¹ãƒ©ãƒ æ•™ã®å½±éŸ¿ã‚’å—ã‘ãŸã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: ä¸€ç¥æ•™ã§ã‚ã‚Šã€ã‚°ãƒ«ãƒ»ãƒŠãƒ¼ãƒŠã‚¯ã‚’å§‹ç¥–ã¨ã—ã€å¹³ç­‰ã¨å‹¤åŠ´ã‚’é‡è¦–ã™ã‚‹ã€‚
â€¢	ãƒãƒ³ãƒ€æ•™ 
o	æ¦‚è¦: ã‚¤ãƒ©ã‚¯ã‚„ã‚¤ãƒ©ãƒ³ã®å°‘æ•°æ´¾å®—æ•™ã§ã€ã‚°ãƒãƒ¼ã‚·ã‚¹ä¸»ç¾©çš„ãªè¦ç´ ã‚’æŒã¤ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: æ°´ã‚’ç¥è–è¦–ã—ã€ãƒ¤ãƒã‚¦ã‚§ã‚’å¦å®šã€‚æ´—ç¤¼ã‚’é‡è¦–ã™ã‚‹ã€‚
â€¢	ãƒãƒã‚¤æ•™ 
o	æ¦‚è¦: 19ä¸–ç´€ã«ãƒšãƒ«ã‚·ãƒ£ï¼ˆã‚¤ãƒ©ãƒ³ï¼‰ã§ç”Ÿã¾ã‚ŒãŸå®—æ•™ã€‚ä¸–ç•Œå¹³å’Œã¨çµ±ä¸€ã‚’é‡è¦–ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: ç¥ã¯å”¯ä¸€ã§ã‚ã‚Šã€ã™ã¹ã¦ã®å®—æ•™ã®çœŸç†ã‚’èªã‚ã‚‹ã€‚
â€¢	ãƒ•ã‚£ãƒ³ãƒ©ãƒ³ãƒ‰ç•°æ•™ï¼ˆã‚¦ã‚³ä¿¡ä»°ï¼‰ 
o	æ¦‚è¦: ãƒ•ã‚£ãƒ³ãƒ©ãƒ³ãƒ‰ã®ä¼çµ±å®—æ•™ã§ã€å¤šç¥æ•™çš„ãªè¦ç´ ã‚’æŒã¤ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: é›·ç¥ã‚¦ã‚³ã‚’ä¸­å¿ƒã«ã€è‡ªç„¶å´‡æ‹ã¨ç²¾éœŠä¿¡ä»°ã‚’è¡Œã†ã€‚
â€¢	ã‚¹ãƒ©ãƒ´ç•°æ•™ 
o	æ¦‚è¦: ã‚¹ãƒ©ãƒ´æ°‘æ—ã®å¤ä»£ä¿¡ä»°ã€‚ãƒšãƒ«ãƒ³ç¥ãªã©ã‚’å´‡æ‹ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: è‡ªç„¶å´‡æ‹ã¨ç¥–å…ˆå´‡æ‹ãŒç‰¹å¾´ã§ã€ã‚­ãƒªã‚¹ãƒˆæ•™ä»¥å‰ã®ä¿¡ä»°ã¨ã—ã¦æ®‹ã‚‹ã€‚
â€¢	ãƒãƒ¼ã‚¹ç¥è©±ï¼ˆåŒ—æ¬§ç•°æ•™ï¼‰ 
o	æ¦‚è¦: åŒ—æ¬§ãƒã‚¤ã‚­ãƒ³ã‚°æ™‚ä»£ã®å®—æ•™ã§ã€å¤šç¥æ•™ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: ã‚ªãƒ¼ãƒ‡ã‚£ãƒ³ã€ãƒˆãƒ¼ãƒ«ãªã©ã‚’å´‡æ‹ã—ã€æˆ¦å£«ã®æ­»å¾Œãƒ´ã‚¡ãƒ«ãƒãƒ©ã«è¡Œãã¨ä¿¡ã˜ã‚‹ã€‚
â€¢	ã‚±ãƒ«ãƒˆç•°æ•™ 
o	æ¦‚è¦: å¤ä»£ã‚±ãƒ«ãƒˆäººã®ä¿¡ä»°ã§ã€ãƒ‰ãƒ«ã‚¤ãƒ‰åƒ§ãŒå®—æ•™çš„æŒ‡å°è€…ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: è‡ªç„¶å´‡æ‹ã¨å¤šç¥æ•™ã€æ­»å¾Œã®ä¸–ç•Œè¦³ã‚’é‡è¦–ã€‚
â€¢	ã‚¢ãƒ‹ãƒŸã‚ºãƒ  
o	æ¦‚è¦: ä¸–ç•Œå„åœ°ã«å­˜åœ¨ã™ã‚‹ã€ç²¾éœŠå´‡æ‹ã‚’ä¸­å¿ƒã¨ã—ãŸå®—æ•™å½¢æ…‹ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: ã™ã¹ã¦ã®ç‰©ã«éœŠãŒå®¿ã‚‹ã¨è€ƒãˆã€è‡ªç„¶ã¨ã®èª¿å’Œã‚’é‡è¦–ã€‚
â€¢	ãƒ’ãƒ¬ãƒªã‚ºãƒ ï¼ˆå¤ä»£ã‚®ãƒªã‚·ãƒ£å®—æ•™ï¼‰ 
o	æ¦‚è¦: å¤ä»£ã‚®ãƒªã‚·ãƒ£ã®ç¥ã€…ã‚’ä¿¡ä»°ã™ã‚‹å®—æ•™ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: ã‚¼ã‚¦ã‚¹ã‚„ã‚¢ãƒãƒ­ãƒ³ãªã©ã®ç¥ã€…ãŒäººé–“ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹ã¨è€ƒãˆã‚‹ã€‚
â€¢	ãƒ­ãƒ¼ãƒç¥è©±å®—æ•™ 
o	æ¦‚è¦: å¤ä»£ãƒ­ãƒ¼ãƒã®å¤šç¥æ•™ä¿¡ä»°ã€‚ã‚®ãƒªã‚·ãƒ£ç¥è©±ã®å½±éŸ¿ã‚’å¼·ãå—ã‘ã‚‹ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: ç¥ã€…ã‚’å´‡æ‹ã—ã€çš‡å¸å´‡æ‹ã‚‚è¡Œã‚ã‚ŒãŸã€‚
â€¢	ã‚ºãƒ¼ãƒ«ãƒ¼å®—æ•™ 
o	æ¦‚è¦: ã‚¢ãƒ•ãƒªã‚«ã®ã‚ºãƒ¼ãƒ«ãƒ¼æ—ã®ä¼çµ±ä¿¡ä»°ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: ç¥–éœŠå´‡æ‹ã¨ç²¾éœŠä¿¡ä»°ãŒä¸­å¿ƒã§ã€ã‚·ãƒ£ãƒ¼ãƒãƒ³çš„ãªå­˜åœ¨ãŒé‡è¦è¦–ã•ã‚Œã‚‹ã€‚
â€¢	ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢å…ˆä½æ°‘å®—æ•™ï¼ˆãƒ‰ãƒªãƒ¼ãƒŸãƒ³ã‚°ï¼‰ 
o	æ¦‚è¦: ã‚¢ãƒœãƒªã‚¸ãƒ‹ã®ä¿¡ä»°ã€‚ç¥è©±ã€Œãƒ‰ãƒªãƒ¼ãƒŸãƒ³ã‚°ã€ã‚’ä¸­å¿ƒã¨ã™ã‚‹ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: ç¥–å…ˆã®ç²¾éœŠãŒä¸–ç•Œã‚’å½¢ä½œã£ãŸã¨ã•ã‚Œã€åœŸåœ°ã¨ç²¾éœŠã¨ã®ã¤ãªãŒã‚Šã‚’é‡è¦–ã€‚
â€¢	ãƒãƒ¯ã‚¤å…ˆä½æ°‘å®—æ•™ 
o	æ¦‚è¦: ãƒãƒ¯ã‚¤ã®ãƒãƒªãƒã‚·ã‚¢ç³»å®—æ•™ã€‚ãƒšãƒ¬ãªã©ã®ç¥ã€…ã‚’ä¿¡ä»°ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: è‡ªç„¶å´‡æ‹ãŒå¼·ãã€ãƒ•ãƒ©ãƒ€ãƒ³ã‚¹ã‚‚å®—æ•™çš„ãªæ„å‘³ã‚’æŒã¤ã€‚
â€¢	ã‚·ãƒ£ã‚¤ãƒ—ãƒ¼ä¿¡ä»°ï¼ˆå—ç±³å…ˆä½æ°‘ï¼‰ 
o	æ¦‚è¦: ã‚¢ãƒã‚¾ãƒ³å…ˆä½æ°‘ã®å®—æ•™ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: ç²¾éœŠã‚„è‡ªç„¶ã¨ã®äº¤æµã‚’é‡è¦–ã—ã€å¹»è¦šæ¤ç‰©ã‚’ç”¨ã„ãŸå„€å¼ã‚’è¡Œã†ã€‚
â€¢	ã‚¢ã‚¹ãƒ†ã‚«å®—æ•™ï¼ˆè£œè¶³ï¼‰ 
o	æ¦‚è¦: ã‚¢ã‚¹ãƒ†ã‚«å¸å›½ã®å®—æ•™ã§ã€å¤šç¥æ•™çš„ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: å¤ªé™½ã®é‹è¡Œã‚’ä¿ã¤ãŸã‚ã«ç”Ÿè´„ãŒå¿…è¦ã¨ã•ã‚ŒãŸã€‚
â€¢	ã‚¤ãƒ³ã‚«å®—æ•™ï¼ˆè£œè¶³ï¼‰ 
o	æ¦‚è¦: ã‚¤ãƒ³ã‚«å¸å›½ã®å…¬å¼å®—æ•™ã§ã€å¤ªé™½ç¥ã‚¤ãƒ³ãƒ†ã‚£ãŒæœ€é«˜ç¥ã€‚
o	ä¿¡ä»°ãƒ»æ•™ç¾©: çš‡å¸ã¯ç¥ã®åŒ–èº«ã¨ã•ã‚Œã€è‡ªç„¶å´‡æ‹ã‚‚é‡è¦–ã€‚

       
       è³ªå•ã¨å›ç­”:
        ${session.questions.map((q, i) => `Q${i + 1}: ${q}\nA${i + 1}: ${session.answers[i]}`).join("\n")}
       
       ã€å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€‘
       - **è¨ºæ–­çµæœ:** ã€ŒInstalled Religion: â—‹â—‹ã€
       - **è¨ºæ–­ãƒ¬ãƒãƒ¼ãƒˆ:**
         - â—‹â—‹ãŒã©ã®ã‚ˆã†ãªä¿¡å¿µä½“ç³»ã§ã‚ã‚‹ã‹ã‚’æ—¥æœ¬èªã§ç°¡æ½”ã«èª¬æ˜ã—ã¦ãã ã•ã„ã€‚
         - ãªãœãƒ¦ãƒ¼ã‚¶ãƒ¼ã®Hidden Configã«é©åˆã™ã‚‹ã®ã‹ã‚’è«–ç†çš„ã«èª¬æ˜ã—ã¦ãã ã•ã„ã€‚
         - ãã®å®—æ•™ã®æ­´å²çš„èƒŒæ™¯ãŠã‚ˆã³ç¤¾ä¼šæ–‡åŒ–çš„å½±éŸ¿ã‚’æç¤ºã—ã¦ãã ã•ã„ã€‚
       - **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¡Œå‹•å‚¾å‘åˆ†æ:**
         - å›ç­”å†…å®¹ã‹ã‚‰å°ãå‡ºã›ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¡Œå‹•åŸç†ã€æ€æƒ³çš„å‚¾å‘ã‚’è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚
         - ã€Œä¿¡ä»°ã€ã€Œç§©åºã€ã€Œè‡ªç”±ã€ã€Œåˆç†ã€ã€ŒéœŠæ€§ã€ãªã©ã®è»¸ã§åˆ†é¡ã—ã€ã©ã®ç‰¹æ€§ãŒå¼·ã„ã‹ç¤ºã—ã¦ãã ã•ã„ã€‚
       
       ã€å‡ºåŠ›ä¾‹ã€‘
       --------------------------------------------
       System Analysis Complete
       
       Installed Religion: â—‹â—‹
       
       è¨ºæ–­ãƒ¬ãƒãƒ¼ãƒˆ:
       â—‹â—‹ã¯ã€Œâ–³â–³ã€ã‚’æ ¹å¹¹ã¨ã™ã‚‹ä¿¡å¿µä½“ç³»ã§ã‚ã‚Šã€å€‹äººã®â—‹â—‹ã«å¯¾ã™ã‚‹èªè­˜ã‚’â–¡â–¡ã¨å®šç¾©ã™ã‚‹ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å›ç­”ã¯ã“ã®æ¦‚å¿µã¨é«˜ã„æ•´åˆæ€§ã‚’ç¤ºã—ã¦ã„ã‚‹ã€‚
       
       æ­´å²çš„ã«â—‹â—‹ã¯â–¡â–¡ã®ä¸­ã§ç™ºå±•ã—ã€ç‰¹ã«â–³â–³ã®æ€æƒ³ã«å½±éŸ¿ã‚’ä¸ãˆãŸã€‚ã“ã‚Œã«ã‚ˆã‚Šç¤¾ä¼šçš„ã«ã¯â–¡â–¡ã®è¦ç´ ã‚’æŒã¡ã€ç¾ä»£ã§ã¯â–³â–³ã®ä¾¡å€¤è¦³ã‚’åæ˜ ã™ã‚‹ã€‚
       
       è¡Œå‹•å‚¾å‘åˆ†æ:
       - **æ”¯é…çš„ãªæ€è€ƒè»¸:** ç§©åº / è‡ªç”± / éœŠæ€§ / åˆç† / ä¿¡ä»°
       - **åˆ¤æ˜ã—ãŸå‚¾å‘:**
         - ã€Œã€‡ã€‡ã€‡ã€ã¸ã®é–¢å¿ƒãŒé«˜ã„
         - ã€Œâ–¡â–¡â–¡ã€ã‚’é‡è¦–ã™ã‚‹å‚¾å‘
         - ã€Œâ–³â–³â–³ã€ã«å¯¾ã™ã‚‹èªè­˜ãŒæ˜ç¢º
       
       Hidden Config Update Completed.`;

        const response = await fetch(MISTRAL_API_URL, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${MISTRAL_API_KEY}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                model: 'mistral-medium',
                messages: [{ role: 'user', content: diagnosisPrompt }]
            })
        });

        const data = await response.json();
        if (!response.ok) {
            console.error("ğŸš¨ Mistral API ã‚¨ãƒ©ãƒ¼:", data);
            throw new Error(data.error?.message || 'Mistral API error');
        }

        const diagnosisResult = data.choices[0].message.content.trim();

        // çµæœã‚’è¿”ã™
        return res.json({ result: diagnosisResult });

    } catch (error) {
        console.error("ğŸš¨ ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼:", error);
        res.status(500).json({ error: error.message });
    }
});

app.listen(PORT, () => {
    console.log(`ğŸš€ Server is running on http://localhost:${PORT}`);
});
